---
title: "Vulnerability and linkage indicators"
output: html_notebook
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  eval = FALSE,
  echo = TRUE
)
```


#0. Introduction

In this notebook we analyze linkages and we buil a vulnerability indicator based on Herfindahl concentration indicator with two approaches (classical and in value chains).


#1. Linkages

Interpretation : 

BwdLinkage_j: measures the direct and indirect effect of a one-euro increase in final demand for domestic production of product j on the output of the economy as a whole. Variant: exclude elements on the diagonal of the L matrix, to measure the upstream dependence of an industry on the rest of the economy.
Miller-Blair: In its simplest form, a measure of the intensity of backward linkages in sector j - i.e., the extent to which production in sector j depends on inter-industry inputs - is given by the sum of the elements in the jth column of the direct input coefficient matrix. To capture direct and indirect linkages in an economy, the sums of the columns of the total requirements matrix, L = [lij], have been proposed as a measure of total backward linkages (Rasmussen, 1957); these are production multipliers.

FwdLinkage_i: measures the direct and indirect effect of a unit increase in the price of primary inputs from industry i on the value of output from all industries in the economy. Variant: exclude from the measure the elements on the diagonal of the G matrix, to measure the downstream dependence of an industry on the rest of the economy.
Miller-Blair: This dissatisfaction led to the suggestion that elements of the Ghosh model would be more appropriate for measuring downstream links (Beyers, 1976; Jones, 1976). Bi line sums have been suggested as better measures of direct downstream linkages.

Build linkage results databases (using function "BoucleLinkageBwdFwd")

```{r}
## Path
PathTest<-getwd( )  # "C:/Users/SJOITL/Desktop/temporaire/test/"
PathTemp<-getwd( )  # "C:/Users/SJOITL/Desktop/temporaire/"


Interm_LRWIOD <- readRDS(paste0(PathTemp, "BDn_LR_WIOD.rds"))
Interm_WIOD <- readRDS(paste0(PathTemp, "BDn_WIOD.rds"))
Interm_FIG <- readRDS(paste0(PathTemp, "BDn_FIG.rds"))

LinkageBwdFwd_LRWIOD <- BoucleLinkageBwdFwd(Interm_LRWIOD, 1965:1999, OptMRIO = FALSE)
saveRDS(LinkageBwdFwd_LRWIOD, "RESULT_LinkageBwdFwd_LRWIOD.rds")

LinkageBwdFwd_WIOD <- BoucleLinkageBwdFwd(Interm_WIOD, 2000:2014, OptMRIO = FALSE)
saveRDS(LinkageBwdFwd_WIOD, "RESULT_LinkageBwdFwd_WIOD.rds")

LinkageBwdFwd_FIG <- BoucleLinkageBwdFwd(Interm_FIG, 2010:2020, OptMRIO = FALSE)
saveRDS(LinkageBwdFwd_FIG, "RESULT_LinkageBwdFwd_FIGARO.rds")
```

##Graphically cross-tabulate backward (Bwd) and forward (Fwd) linkages in 2019

```{r}
library(data.table)
library(ggplot2)
library(dplyr)

# Loading backward et forward databases (database build in previous chunk)
BASEres_LinkageBwdFwd_LRWIOD <- readRDS(paste0(PathTemp, "RESULT_LinkageBwdFwd_LRWIOD.rds"))
BASEres_LinkageBwdFwd_WIOD <- readRDS(paste0(PathTemp, "RESULT_LinkageBwdFwd_WIOD.rds"))
BASEres_LinkageBwdFwd_FIG <- readRDS(paste0(PathTemp, "RESULT_LinkageBwdFwd_FIGARO.rds"))

Cartouche_FwdBwd <- function(BaseRes, annee, nudge = 0.005) {
  ########################### Cross Bwd and Fwd on 2019
  LinkageBwdFwd_Bwd <- BaseRes[["Indic_Bwd_byCountry"]][Lig_Country == "FRA" & year == annee, ][, link := "Bwd"]
  LinkageBwdFwd_Fwd <- BaseRes[["Indic_Fwd_byCountry"]][Col_Country == "FRA" & year == annee, ][, link := "Fwd"]
  setnames(LinkageBwdFwd_Fwd, c("Col_Country", "Col_Indus"), c("Lig_Country", "Lig_Indus"))
  LinkageBwdFwd <- rbind(LinkageBwdFwd_Bwd, LinkageBwdFwd_Fwd)

  LinkageBwdFwd_tab <- dcast(LinkageBwdFwd, Lig_Indus ~ link, value.var = "value")

  p <- ggplot(LinkageBwdFwd_tab, aes(x = Bwd, y = Fwd)) +
    geom_point() + # Show dots
    geom_label(
      label = LinkageBwdFwd_tab$Lig_Indus,
      nudge_x = nudge, nudge_y = nudge,
      check_overlap = T
    )
  print(p + geom_hline(data = LinkageBwdFwd_tab, yintercept = mean(LinkageBwdFwd_tab$Fwd)) + geom_vline(data = LinkageBwdFwd_tab, xintercept = mean(LinkageBwdFwd_tab$Bwd)))
}

Cartouche_FwdBwd(BASEres_LinkageBwdFwd_FIG, 2019, nudge = 0.0001)
Cartouche_FwdBwd(BASEres_LinkageBwdFwd_FIG, 2010, nudge = 0.0001)
```

##Comparison FRA-DEU-ITA-ESP : Graphically cross-tabulate backward (Bwd) and forward (Fwd) linkages in 2019

```{r}
library(data.table)
library(ggplot2)

# Loading backward et forward databases
BASEres_LinkageBwdFwd_LRWIOD <- readRDS(paste0(PathTemp, "RESULT_LinkageBwdFwd_LRWIOD.rds"))
BASEres_LinkageBwdFwd_WIOD <- readRDS(paste0(PathTemp, "RESULT_LinkageBwdFwd_WIOD.rds"))
BASEres_LinkageBwdFwd_FIG <- readRDS(paste0(PathTemp, "RESULT_LinkageBwdFwd_FIGARO.rds"))

Cartouche_FwdBwd <- function(BaseRes, annee, OtherCountry, nudge = 0.005) {
  ########################### Cross Bwd and Fwd on 2019
  LinkageBwdFwd_Bwd <- BaseRes[["Indic_Bwd_byCountry"]][Lig_Country %in% c("FRA", OtherCountry) & year == annee, ][, link := "Bwd"]
  LinkageBwdFwd_Fwd <- BaseRes[["Indic_Fwd_byCountry"]][Col_Country %in% c("FRA", OtherCountry) & year == annee, ][, link := "Fwd"]
  setnames(LinkageBwdFwd_Fwd, c("Col_Country", "Col_Indus"), c("Lig_Country", "Lig_Indus"))
  LinkageBwdFwd <- rbind(LinkageBwdFwd_Bwd, LinkageBwdFwd_Fwd)
  LinkageBwdFwd$PR <- paste0(LinkageBwdFwd$Lig_Country, "_", LinkageBwdFwd$Lig_Indus)

  LinkageBwdFwd_tab <- dcast(LinkageBwdFwd, PR ~ link, value.var = "value")

  p <- ggplot(LinkageBwdFwd_tab, aes(x = Bwd, y = Fwd)) +
    geom_point() + # Show dots
    geom_label(
      label = LinkageBwdFwd_tab$PR,
      nudge_x = nudge, nudge_y = nudge,
      check_overlap = T
    )
  print(p + geom_hline(data = LinkageBwdFwd_tab, yintercept = mean(LinkageBwdFwd_tab$Fwd)) + geom_vline(data = LinkageBwdFwd_tab, xintercept = mean(LinkageBwdFwd_tab$Bwd)))
}

Cartouche_FwdBwd(BASEres_LinkageBwdFwd_FIG, 2019, OtherCountry = "DEU", nudge = 0.0001)
Cartouche_FwdBwd(BASEres_LinkageBwdFwd_FIG, 2019, OtherCountry = "ITA", nudge = 0.0001)
Cartouche_FwdBwd(BASEres_LinkageBwdFwd_FIG, 2019, OtherCountry = "ESP", nudge = 0.0001)

Cartouche_FwdBwd(BASEres_LinkageBwdFwd_FIG, 2010, OtherCountry = "DEU", nudge = 0.0001)
```

##Analysis of linkages split in DOM/IMP in series for FRA

```{r}
library(data.table)
library(ggplot2)

# Loading backward et forward databases
BASEres_LinkageBwdFwd_LRWIOD <- readRDS(paste0(PathTemp, "RESULT_LinkageBwdFwd_LRWIOD.rds"))
BASEres_LinkageBwdFwd_WIOD <- readRDS(paste0(PathTemp, "RESULT_LinkageBwdFwd_WIOD.rds"))
BASEres_LinkageBwdFwd_FIG <- readRDS(paste0(PathTemp, "RESULT_LinkageBwdFwd_FIGARO.rds"))

Graph_Part_DOM <- function(BaseBwdFwd) {
  LinkageBwdFwd_Bwd <- BaseBwdFwd[["Indic_Bwd_PartDOM"]][Col_Country == "FRA", ]
  LinkageBwdFwd_Bwd <- setDF(LinkageBwdFwd_Bwd)
  print(ggplot(LinkageBwdFwd_Bwd, aes(x = year, y = Part_Dom, colour = Col_Indus)) +
    geom_line())
}
Graph_Part_DOM(BASEres_LinkageBwdFwd_LRWIOD)
Graph_Part_DOM(BASEres_LinkageBwdFwd_WIOD)
Graph_Part_DOM(BASEres_LinkageBwdFwd_FIG)
```



#2. Vulnerability (Herfindahl concentration indicator)



##2.1 Classical indicator (companies side with supplier tensions)



Build Indicator calculation for 2019
```{r}
BASE_FIG <- readRDS("Sorties/BDn_FIG.rds")
MRIO <- CompoMRIO(BASE_FIG, typeCompo = "OptFullOptions", date = 2019)
H_FIG_2019 <- Herfindahl(MRIO)

Indic_H <- H_FIG_2019[["H_Indics"]][IndicH == "full", ]
Indic_H[, IndicH := "Herfindahl_fois100"]
Indic_H_tab <- dcast(Indic_H, Col_Indus ~ Col_Country, value.var = "value")

Struct_H <- Indic_H[, dispers := mean(value, na.rm = T), by = c("Col_Indus")]
Struct_H <- Struct_H[Col_Country == "FRA", ][, value := NULL][, IndicH := "Dispersion"] # FRA pas specifique ici, juste pour avoir la liste de indus
Struct_H[, Col_Country := "WORLD", ]
Struct_H <- GereInfNA(Struct_H)
setnames(Struct_H, "dispers", "value")
interm <- Struct_H[Indic_H, on = .(Col_Indus)]
interm <- interm[, c("Col_Indus", "IndicH", "i.Col_Country", "value")]
setnames(interm, "i.Col_Country", "Col_Country")
Struct_H <- interm

CI_dt <- MRIO[["CI"]]
CI_dt_imp <- MRIO[["CI"]][Lig_Country != Col_Country, ]
PartCI1 <- CI_dt[, sum(value), by = c("Col_Country", "Col_Indus")]
PartCI2 <- CI_dt_imp[, sum(value), by = c("Col_Country", "Col_Indus")]
setnames(PartCI2, "V1", "imp")
PartCI <- cbind(PartCI1, PartCI2)
PartCI[, V2 := imp / V1]
PartCIimpDansCI <- GereInfNA(PartCI)
PartCIimpDansCI <- PartCIimpDansCI[, c("Col_Country", "Col_Indus", "V2")][, IndicH := "PartCIimpDansCI"]
setnames(PartCIimpDansCI, "V2", "value")

Indic_H[, dispers := NULL]
Base_Herfin_Brut <- rbind(Indic_H, Struct_H, PartCIimpDansCI)
saveRDS(Base_Herfin_Brut, "Base_Herf_Brut.rds")
```

Analysis of Herfindahl data (build previously)
```{r}
Herf_w <- readRDS("Base_Herf_Brut.rds")

Herf_w_FRA <- Herf_w[Col_Country == "FRA", ]
print(unique(Herf_w_FRA[, "IndicH"]))
Herf_w_FRA$value <- as.numeric(Herf_w_FRA$value)
Herf_w_FRA <- setDT(Herf_w_FRA)
Herf_w_FRA_tab <- dcast(Herf_w_FRA, Col_Indus ~ IndicH, value.var = "value")

print(min(Herf_w_FRA_tab$Dispersion))
print(max(Herf_w_FRA_tab$Dispersion))


ggplot(Herf_w_FRA_tab, aes(x = Herfindahl_fois100, y = PartCIimpDansCI, size = Dispersion)) +
  geom_point(alpha = 0.5) +
  scale_size(range = c(.1, 10), name = "Mean Herfindahl inter-countries") +
  scale_fill_viridis(discrete = TRUE, guide = FALSE, option = "A") +
  theme_ipsum() +
  theme(legend.position = "bottom") +
  ylab("Share of CI imported in CI") +
  xlab("Indice Herfindahl / mult100") +
  theme(legend.position = "right")

### France-Germany
Herf_w_FRADEU <- Herf_w[Col_Country %in% c("FRA", "DEU"), ]
Herf_w_FRADEU$value <- as.numeric(Herf_w_FRADEU$value)
Herf_w_FRADEU_tab <- dcast(Herf_w_FRADEU, Col_Country + Col_Indus ~ IndicH, value.var = "value")

ggplot(Herf_w_FRADEU_tab, aes(x = Herfindahl_fois100, y = PartCIimpDansCI, size = Dispersion, color = Col_Country)) +
  geom_point(alpha = 0.5) +
  scale_size(range = c(.1, 10), name = "Mean of Herfindahl indicators inter-countries") +
  scale_fill_viridis(discrete = TRUE, guide = FALSE, option = "A") +
  theme_ipsum() +
  theme(legend.position = "bottom") +
  ylab("Share of CI imported in CI") +
  xlab("Indice Herfindahl / mult100") +
  theme(legend.position = "right")


### MultiPays
List_pays <- c("FRA", "DEU", "ITA", "ESP")
Herf_w_MultiPays <- Herf_w[Col_Country %in% List_pays, ]
Herf_w_MultiPays$value <- as.numeric(Herf_w_MultiPays$value)
Herf_w_MultiPays_tab <- dcast(Herf_w_MultiPays, Col_Country + Col_Indus ~ IndicH, value.var = "value")

ggplot(Herf_w_MultiPays_tab, aes(x = Herfindahl_fois100, y = PartCIimpDansCI, size = Dispersion, color = Col_Country)) +
  geom_point(alpha = 0.5) +
  scale_size(range = c(.1, 4), name = "Mean of Herfindahl indicators inter-countries") +
  scale_fill_viridis(discrete = TRUE, guide = FALSE, option = "A") +
  theme_ipsum() +
  theme(legend.position = "bottom") +
  ylab("Share of CI imported in CI") +
  xlab("Indice Herfindahl / mult100") +
  theme(legend.position = "right")
```

##2.2 New indicator in value chains (households side with supplier tensions on demand)

Build result database with the calculation of content in value added imported in final demand

```{r}
ListePays <- unlist(unique(A_dt[, "Lig_Country"]))
print(ListePays)
print(length(ListePays))

print(ListePays[[2]])

BaseContenusVAimportee <- ImportedContentInVA(pays = ListePays[[1]])
for (k in 2:length(ListePays)) {
  BaseContenusVAimportee <- rbind(BaseContenusVAimportee, ImportedContentInVA(pays = ListePays[[k]]))
  print(k)
}

saveRDS(BaseContenusVAimportee, "BaseContenusVAimportee.RDS")
```



Calculation of the new indicator of vulnerability in value chains

```{r}
BASE_FIG <- readRDS(paste0(PathTemp, "BDn_FIG.rds"))
gc()
# MRIO <- CompoMRIO(BASE_FIG, typeCompo = "OptFullOptionsBonus", date = 2019)
MRIO <- readRDS(paste0(PathTest, "HRMwide_REF_FIG2019.rds"))
gc()

TypContenu <- "VA" # "Emi"
yearRecup <- 2019
OptCoefEmi <- "TxEmissionsDep"
MRIO2 <- MRIO

# MRIO components for calculation
A_dt <- MRIO[["A"]]
A_dt_testNeg <- A_dt[value < 0, ]
A_dt <- AjoutPRBR(A_dt)
if (TypContenu == "VA") {
  f_dt <- MRIO[["VA"]] # Initialization
}
if (TypContenu == "Emi") {
  f_dt <- MRIO[["VA"]]
  f_dt$value <- RecupVectEmiFigaro(yearRecup, AjoutPRBR(MRIO[["PROD"]])) # Initialization
  f_dt <- AjoutPRBR(f_dt)
  f_dt[, PR := NULL]
  # setnames(f_dt,"PR","BR")
  if (OptCoefEmi == "TxEmissionsDep") {
    if (!is.null(MRIO2)) {
      SimuCoefEmi <- TxEmissionsDepart(MRIO2, MRIO)
      f_dtbis <- as.matrix(f_dt$value * SimuCoefEmi, drop = FALSE)
      rownames(f_dtbis) <- rownames(f_dt)
      colnames(f_dtbis)[1] <- "value"
      f_dt <- as.data.frame(f_dtbis, drop = F)
      f_dt <- GereInfNA(f_dt)
      f_dt <- as.data.frame(f_dt, drop = F)
      f_dtbis <- MRIO[["VA"]] # remise en format VA
      f_dtbis$value <- f_dt$value
      f_dt <- f_dtbis
    }
  }
}
Prod_dt <- MRIO[["PROD"]]
f_dt$value <- f_dt$value / Prod_dt$value
class(f_dt)
f_dt <- GereInfNA(f_dt)
f_dt <- diag(unlist(f_dt$value))

DF_FRA <- MRIO[["DF"]][Col_Country == "FRA", sum(value), by = c("Lig_Country", "Lig_Indus", "Col_Country")]
print(sum(DF_FRA$V1))
DF_FRA <- DF_FRA[order(Lig_Country, Lig_Indus)]
DF_FRA_mat <- matrix(diag(unlist(DF_FRA[, "V1"])), ncol = 2944)
print(sum(DF_FRA_mat))
print(sum(DF_FRA$V1))

Mat_L <- Prod_dt <- MRIO[["L"]]
Mat_L_mat <- as.matrix(Mat_L)

Matrice_Empreinte <- CFPcalculationRCPP(f_dt, Mat_L_mat, DF_FRA_mat)
Matrice_Empreinte[Matrice_Empreinte < 0] <- 0
Tot_Matrice_Empreinte <- sum(Matrice_Empreinte, na.rm = T)
print(Tot_Matrice_Empreinte)

Matrice_Empreinte <- setDT(as.data.frame(Matrice_Empreinte))
MaMat <- cbind(MRIO[["CI_tab"]][, 1:3], Matrice_Empreinte)
colnames(MaMat) <- colnames(MRIO[["CI_tab"]])
MaMat <- MaMat[, -1]
MaMat_long <- melt(MaMat, id.vars = c("Lig_Country", "Lig_Indus"))
MaMat_long$Col_Country <- str_extract(MaMat_long$variable, "[^_]+")
MaMat_long$Col_Indus <- substring(str_extract(MaMat_long$variable, "_.+$"), 2)
MaMat_long <- MaMat_long[, variable := NULL]
MaMat_long <- MaMat_long[Lig_Country != "FRA", ]

ContenusFRA_byBranches <- MaMat_long[, sum(value, na.rm = T), by = c("Lig_Country", "Lig_Indus", "Col_Indus")]
setnames(ContenusFRA_byBranches, "V1", "value")
print(sum(ContenusFRA_byBranches$value, na.rm = T))

MargContenus <- MaMat_long[, sum(value, na.rm = T), by = c("Col_Indus")]
setnames(MargContenus, "V1", "value")
print(sum(MargContenus$value))

StrucContenus <- MargContenus[ContenusFRA_byBranches, on = "Col_Indus"]
StrucContenus$part <- StrucContenus$i.value / StrucContenus$value
StrucContenus$part2 <- StrucContenus$part * StrucContenus$part
StrucContenus <- StrucContenus[part > 0, ]

# Herfindahl Index calculation of import content of French final demand by country*industry of origin (for each industry in column in the footprint matrix): concentration by country of origin in value chain (new)

HerfContenus <- StrucContenus[, 100 * sum(part2, na.rm = T), by = c("Col_Indus")]

# Content in imported VA for France in level
VA_Imp_niveau <- MargContenus
setnames(VA_Imp_niveau, "value", "VA_Imp_niveau")

# Correlations
ImpVA <- readRDS("BaseContenusVAimportee.RDS") # Calculated in a previous chunk
ImpVA_tab <- dcast(ImpVA, Lig_Country + Lig_Indus ~ Col_Indus + ContenuDuPays, value.var = "value")
ImpVA_horsFRA <- ImpVA[Lig_Country != "FRA", ]
Part1_FRA <- ImpVA_horsFRA[ContenuDuPays == "FRA", ]
Part2_RDM <- ImpVA_horsFRA[ContenuDuPays != "FRA", sum(value), by = c("Lig_Country", "Lig_Indus", "Col_Indus")]
setnames(Part2_RDM, "V1", "value")
Part2_RDM <- Part2_RDM[, ContenuDuPays := "RDM"]
AgrImpVA <- rbind(Part1_FRA, Part2_RDM)
AgrImpVA_tab <- dcast(AgrImpVA, Lig_Country + Lig_Indus ~ Col_Indus + ContenuDuPays, value.var = "value")
print(cor(AgrImpVA_tab$A01_FRA, AgrImpVA_tab$A01_RDM))
print(cor(AgrImpVA_tab$A02_FRA, AgrImpVA_tab$A02_RDM))
AgrImpVA_tab <- setDF(AgrImpVA_tab)



library(rlist)
for (k in 1:64) {
  indi <- 2 * k + 1
  name1 <- colnames(AgrImpVA_tab)[indi]
  calc <- cor(AgrImpVA_tab[, indi], AgrImpVA_tab[, indi + 1])
  if (k == 1) {
    li <- list(corr = calc, name = name1)
  } else {
    li <- list.append(li, list(corr = calc, name = name1))
  }
}
li_dt <- as.data.table(li)
tli_dt <- t(li_dt)
tli_dt[2, 1] <- tli_dt[1, 1]
tli_dt <- tli_dt[-1, ]
tab_corr <- tli_dt
class(tab_corr)
tab_corr <- as.data.frame(t(tab_corr))
ttab_corr <- as.data.frame(t(tab_corr))
colnames(ttab_corr) <- c("Corr_Depend", "ind")

# Tab graph

Herf_w <- readRDS("Base_Herf_Brut.rds") # Created in a previous chunk

Herf_w_FRA <- Herf_w[Col_Country == "FRA", ]
print(unique(Herf_w_FRA[, "IndicH"]))
Herf_w_FRA$value <- as.numeric(Herf_w_FRA$value)
Herf_w_FRA_tab <- dcast(Herf_w_FRA, Col_Indus ~ IndicH, value.var = "value")

Herf_w_FRA_tab <- cbind(Herf_w_FRA_tab, HerfContenus, VA_Imp_niveau, ttab_corr)
setnames(Herf_w_FRA_tab, "V1", "HerfContenuVA")

HerfGraph <- Herf_w_FRA_tab[-65, ]
HerfGraph <- HerfGraph[-64, ]
HerfGraph <- HerfGraph[-63, ]
HerfGraph <- HerfGraph[, -1]
HerfGraph <- HerfGraph[, -4]

HerfGraph$Corr_Depend <- as.numeric(HerfGraph$Corr_Depend)
HerfGraph$VA_Imp_niveau <- as.numeric(HerfGraph$VA_Imp_niveau)
HerfGraph$HerfContenuVA <- as.numeric(HerfGraph$HerfContenuVA)
HerfGraph$Corr_Depend_norm <- (HerfGraph$Corr_Depend - min(HerfGraph$Corr_Depend, na.rm = T)) / (max(HerfGraph$Corr_Depend, na.rm = T) - min(HerfGraph$Corr_Depend, na.rm = T))

HerfGraph <- HerfGraph %>%
  mutate(Corr_Color = case_when(
    HerfContenuVA < 2.5 ~ "blue",
    VA_Imp_niveau < 10000 ~ "blue",
    VA_Imp_niveau > 20000 ~ "blue",
    .default = "red"
  ))

saveRDS(HerfGraph, "HerfGraph.RDS")

library(viridis)
library(hrbrthemes)
png(file = "GraphHerf.png", width = 600, height = 350)
p <- ggplot(HerfGraph, aes(x = HerfContenuVA, y = VA_Imp_niveau, size = Corr_Depend)) +
  geom_point(alpha = 0.5, aes(colour = factor(Corr_Color))) +
  scale_size(range = c(.1, 10), name = "Corr-dependance") +
  scale_fill_viridis(discrete = TRUE, guide = FALSE, option = "A") +
  theme_ipsum() +
  theme(legend.position = "bottom") +
  ylab("Niveau des contenus en VA / Mâ‚¬") +
  xlab("HHI contenus en VA de DF / fois100") +
  theme(legend.position = "right") +
  geom_text(
    label = HerfGraph$Col_Indus,
    # nudge_x = 0.25, nudge_y = 0.25,
    size = 4,
    check_overlap = F
  )
dev.off()

print(p)
```
